# Setting Up Telegram Integration with n8n

This guide will help you set up a Telegram bot that uses n8n for processing messages and responding with AI-generated content using Ollama.

## Prerequisites

1. Docker Desktop installed and running
2. The cloud-local-ngrok stack installed and running
3. A Telegram account

## Step 1: Create a Telegram Bot

1. Open Telegram and search for `@BotFather`
2. Start a chat with BotFather and send the command `/newbot`
3. Follow the instructions to:
   - Give your bot a name (e.g., "My n8n AI Assistant")
   - Choose a username for your bot (must end with "bot", e.g., "my_n8n_assistant_bot")
4. BotFather will provide you with a token. It looks like `123456789:ABCDefGhIJKlmNoPQRsTUVwxyZ`. **Save this token** as you'll need it later.

## Step 2: Set Up Your n8n Environment

1. Make sure Docker Desktop is installed and running
2. Open a PowerShell terminal and navigate to your cloud-local-ngrok directory
3. Run the installation script to set up the container stack:
   ```
   .\install.bat
   ```
4. Verify that all services are running:
   ```
   docker ps
   ```
   You should see containers for n8n, Ollama, ngrok, and others.

## Step 3: Configure the Webhook URL

Use the provided PowerShell script to set up the Telegram webhook:

1. Open the `setup-telegram-integration.ps1` file in a text editor
2. Replace `YOUR_BOT_TOKEN` with the token from BotFather
3. Save the file
4. Run the script in PowerShell:
   ```
   .\setup-telegram-integration.ps1
   ```
5. Choose option 1 to set up the webhook with the ngrok URL

This connects your Telegram bot to your n8n instance through the ngrok tunnel.

## Step 4: Import the Telegram Workflow in n8n

1. Access your n8n instance at http://localhost:5678
2. Navigate to "Workflows" in the left sidebar
3. Click "Import from File"
4. Select the `examples/telegram-bot-workflow.json` file
5. Click "Import" to add the workflow to your n8n instance

## Step 5: Configure the Telegram Nodes

1. Open the imported "Telegram AI Assistant with Ollama" workflow
2. Click on the "Telegram trigger" node
3. Click "Add Credential" to create a new Telegram API credential
4. Enter your bot token from BotFather
5. Save the credential
6. Make sure the webhook is set to: `http://localhost:5678/webhook/322dce18-f93e-4f86-b9b1-3305519b7834/webhook`
7. Also configure the "Send AI Response" node with the same credential

## Step 6: Customize the AI Response

1. Click on the "Generate AI Response" node
2. Verify that it's using an Ollama model that's available in your installation
   - Default is `llama2:latest`
   - If you want to use a different model, change it and make sure it's pulled in Ollama
3. Adjust the system instructions if desired to change how your bot responds

## Step 7: Activate the Workflow

1. Click the "Active" toggle in the top-right corner of the n8n interface
2. Confirm the activation

## Step 8: Test Your Telegram Bot

1. Open Telegram and find your bot by its username
2. Start a chat with your bot
3. Send a message to your bot
4. You should receive a response generated by the Ollama model

## Troubleshooting

### Webhook Issues

If your bot isn't responding:

1. Check that the ngrok tunnel is active by visiting http://localhost:4040
2. Verify the webhook is correctly set by running option 3 in the setup script
3. Make sure the workflow is activated in n8n
4. Check the execution history in n8n for any errors

### Docker Issues

If Docker containers aren't running:

1. Make sure Docker Desktop is installed and running
2. Try restarting Docker Desktop
3. Run `docker-compose down` followed by `docker-compose up -d` in your cloud-local-ngrok directory

### n8n Issues

If n8n isn't working properly:

1. Check the logs: `docker logs ai-stack_n8n_1`
2. Make sure all required services are running
3. Try restarting the n8n container

## Advanced Configuration

### Customizing Responses

- Edit the "Generate AI Response" node's system instructions to change your bot's personality and capabilities
- Adjust temperature, top-p, and max tokens settings to control response length and creativity

### Adding More Features

- Add nodes to the workflow to:
  - Process images sent to the bot
  - Connect to external APIs for weather, news, etc.
  - Store user preferences in a database
  - Schedule messages or reminders

### Security Considerations

- In production, use strong, unique passwords for all services
- Update your `.env` file with secure encryption keys
- Consider using a paid ngrok plan for additional security features

## Next Steps

After your Telegram bot is working:

1. Explore the n8n interface to learn about additional capabilities
2. Try creating your own workflows from scratch
3. Connect your bot to other services using n8n nodes
4. Check out the WhatsApp integration example to expand your messaging capabilities 